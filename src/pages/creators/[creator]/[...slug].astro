---
import Layout from '../../../layouts/Layout.astro';
import { getCollection, getEntries, getEntry } from 'astro:content';

export async function getStaticPaths() {
  const trips = await getCollection('trips');
  const tripsPaths = new Array();
  trips.forEach(trip => {
    const path = trip.id.split('/');
    let t = {
      'params': {
        'creator':path[0],
        'slug':path[1]
      },
      'props': {
        'trip':trip
      }
    }
    tripsPaths.push(t);
  })
  
  return tripsPaths;
}

const { creator } = Astro.params;
const { trip } = Astro.props;

const stops = await getEntries(trip.data.stops);
const creatorData = await getEntry('creators', creator);

const dateOptions: object = {
	year: "numeric",
	month: "long",
	day: "numeric",
	timezone: "America/Chicago"
};

const pageTitle = trip.data.name + " | " + creatorData.data.name;

let youtube;

if (trip.data.source == 'youtube') {
  youtube = true;
}

---

<Layout title={pageTitle}>
  <div class="trip-page">
    <div>
      <h1>{trip.data.name}</h1>
      <h2>{creatorData.data.name}</h2>
      <p>{trip.data.postdate.toLocaleDateString('en-US', dateOptions)}</p>
      <p class="locations">
        {stops.map(stop => (
          // @ts-ignore
          <span>{stop.data.name}</span>
        ))}
      </p>
    </div>
    <div>
      {youtube && <iframe src=`https://www.youtube.com/embed/${trip.data.source_id}` title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>}
    </div>
  </div>
  

</Layout>

<style>
  .trip-page {
    display: grid;
  }
  .locations span {
    display: inline-block;
  }
   .locations span:not(:last-child):after {
      content: 'âž¡';
      margin: 0 5px;
  }
  iframe {
    width: 100%;
    height: auto;
    aspect-ratio: 16/9;
  }
</style>